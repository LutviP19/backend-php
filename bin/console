#!/usr/bin/env php
<?php
define('APP_START', microtime(true));
define('BASEPATH', __DIR__ . '/..');

require_once __DIR__ . '/../vendor/autoload.php';

/**
 * Bootstrap the Application.
 */
/* ----------------------------- Default settings START -------------------------------- */
// Looking for .env at the root directory
$dotenv = Dotenv\Dotenv::createUnsafeImmutable(__DIR__ . '/..');
$dotenv->load();

date_default_timezone_set(env('APP_TIMEZONE', 'Asia/Jakarta'));

//Starting the session will be the first we do.
ini_set('session.save_handler', env('SESSION_DRIVER', 'file'));
if (env('SESSION_DRIVER') === "redis") {
    ini_set('session.save_path', "tcp://" . env('REDIS_HOST') . ":" . env('REDIS_PORT') . "?auth" . env('REDIS_PASSWORD'));
    ini_set('session.gc_maxlifetime', (env('SESSION_LIFETIME', 120) * 60)); // Set default to 2 hours
} else {
    ini_set('session.save_path', __DIR__ . '/../../storage/framework/sessions');
}

session_name('BACKENDPHPSESSID'); // Set a custom session name
session_start();
/* ----------------------------- Default settings END -------------------------------- */

/**
 * Bootstrap the Application
 */
use App\Console\Commands\TestCommand;
use App\Core\Support\App;
use Symfony\Component\Console\Application;
use App\Console\Commands\ClearcacheCommand;

//register configuration to the app.
App::register('config', require __DIR__ . '/../config/app.php');

$app = new Application();
$app->add(new TestCommand());
$app->add(new ClearcacheCommand());
$app->run();